#### 编译和链接

编译是针对单个源文件的，一次编译操作只能编译一个源文件，如果程序中有多个源文件，就需要多次编译操作。

链接（Link）是针对多个文件的，它会将编译生成的多个目标文件以及系统中的库、组件等合并成一个可执行程序。

#### 预处理

这些在编译之前对源文件进行简单加工的过程，就称为预处理（即预先处理、提前处理）。

#### 宏定义

宏（Macro）是预处理命令的一种，它允许用一个标识符来表示一个**字符串**。`字符串`可以是数字、表达式、if 语句、函数等。

**对宏定义的几点说明**

1) 宏定义是用宏名来表示一个字符串，在宏展开时又以该字符串取代宏名，这只是一种简单粗暴的替换。字符串中可以含任何字符，它可以是常数、表达式、if 语句、函数等，预处理程序对它不作任何检查，如有错误，只能在编译已被宏展开后的源程序时发现。

2) 宏定义不是说明或语句，在行末不必加分号，如加上分号则连分号也一起替换。

3) 宏定义必须写在函数之外，其作用域为宏定义命令起到源程序结束。如要终止其作用域可使用`#undef`命令。

4) 代码中的宏名如果被引号包围，那么预处理程序不对其作宏代替。

5) 宏定义允许嵌套，在宏定义的字符串中可以使用已经定义的宏名，在宏展开时由预处理程序层层代换。

**应注意用宏定义表示数据类型和用 [typedef](http://c.biancheng.net/cpp/html/100.html) 定义数据说明符的区别。宏定义只是简单的字符串替换，由预处理器来处理；而 typedef 是在编译阶段由编译器处理的，它并不是简单的字符串替换，而给原有的数据类型起一个新的名字，将它作为一种新的数据类型。**

##### 带参数宏定义

对带参数的宏，在展开过程中不仅要进行字符串替换，还要用实参去替换形参。

定义：

```c
#define 宏名(形参列表) 字符串
```

调用：

```c
宏名(实参列表);
```

举例：

```c
#define M(y) y*y+3*y  //宏定义
// Code
k=M(5);  //宏调用
```

1) 带参宏定义中，形参之间可以出现空格，但是宏名和形参列表之间不能有空格出现。

2) 在带参宏定义中，不会为形式参数分配内存，因此不必指明数据类型。而在宏调用中，实参包含了具体的数据，要用它们去替换形参，因此实参必须要指明数据类型。

3) 在宏定义中，字符串内的形参通常要用括号括起来以避免出错。

```c
#define SQ(y) ((y)*(y))
```

**宏参数的字符串化和宏参数的连接**

`#`用来将宏参数转换为字符串，也就是在宏参数的开头和末尾添加引号。

```c
#define STR(s) #s
```

`##`称为连接符，用来将宏参数或其他的串连接起来。

#### 预定义宏

```c
ANSI C 规定了以下几个预定义宏，它们在各个编译器下都可以使用：
__LINE__：表示当前源代码的行号；
__FILE__：表示当前源文件的名称；
__DATE__：表示当前的编译日期；
__TIME__：表示当前的编译时间；
__STDC__：当要求程序严格遵循ANSI C标准时该标识被赋值为1；
__cplusplus：当编写C++程序时该标识符被定义。
```

#### 条件编译

这种能够根据不同情况编译不同代码、产生不同目标文件的机制，称为条件编译。条件编译是预处理程序的功能，不是编译器的功能。

##### #if 命令

```c
#if 整型常量表达式1
    程序段1
#elif 整型常量表达式2
    程序段2
#elif 整型常量表达式3
    程序段3
#else
    程序段4
#endif
```

需要注意的是，#if 命令要求判断条件为“整型常量表达式”，也就是说，表达式中不能包含变量，而且结果必须是整数；而 if 后面的表达式没有限制，只要符合语法就行。这是 #if 和 if 的一个重要区别。

##### #ifdef 命令

``` 
#ifdef  宏名
    程序段1
#else
    程序段2
#endif
```

##### #ifndef 命令

```c
#ifndef 宏名
    程序段1 
#else 
    程序段2 
#endif
```

**注意的是，#if 后面跟的是“整型常量表达式”，而 #ifdef 和 #ifndef 后面跟的只能是一个宏名，不能是其他的。**

#### #error

\#error 指令用于在编译期间产生错误信息，并阻止程序的编译，其形式如下：

```c
#error error_message
```

